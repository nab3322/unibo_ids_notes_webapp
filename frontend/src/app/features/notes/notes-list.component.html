<div class="notes-container">
  <div class="notes-header">
    <h1>{{ currentFolderId ? 'Note in: ' + currentFolderName : 'Le mie Note' }}</h1>
    <button mat-fab color="primary" routerLink="/notes/new">
      <mat-icon>add</mat-icon>
    </button>
  </div>

  <div *ngIf="currentFolderId" class="folder-filter">
    <mat-icon>folder</mat-icon>
    <span>Filtrando per cartella: <strong>{{ currentFolderName || 'Cartella ' + currentFolderId }}</strong></span>
    <span class="spacer"></span>
    <button mat-button color="primary" (click)="clearFolderFilter()">
      <mat-icon>clear</mat-icon> Mostra tutte
    </button>
  </div>

  <div *ngIf="isLoading" class="loading-shade">
    <p>Caricamento note...</p>
  </div>

  <div *ngIf="!isLoading && notes.length === 0" class="empty-state">
    <mat-icon>note_add</mat-icon>
    <p>Non hai ancora nessuna nota. Crea la tua prima nota!</p>
    <button mat-raised-button color="primary" routerLink="/notes/new">
      Crea Nota
    </button>
  </div>

  <div class="notes-grid" *ngIf="!isLoading && notes.length > 0">
    <mat-card class="note-card" *ngFor="let note of notes">
      <mat-card-header>
        <mat-card-title>{{note.title}}</mat-card-title>
        <mat-card-subtitle>
          {{note.createdAt | date:'dd/MM/yyyy HH:mm':'Europe/Rome'}}
          <span *ngIf="note.folderName" class="folder-badge">
            <mat-icon>folder</mat-icon> {{note.folderName}}
          </span>
        </mat-card-subtitle>
      </mat-card-header>

      <mat-card-content>
        <p class="note-preview">{{note.content}}</p>
      </mat-card-content>

      <mat-card-actions>
        <button mat-button [routerLink]="['/notes', note.id, 'edit']" *ngIf="note.canEdit">Modifica</button>
        <button mat-button [routerLink]="['/notes', note.id, 'edit']" *ngIf="!note.canEdit">Visualizza</button>
        <button mat-icon-button color="primary" (click)="copyNote(note)" matTooltip="Copia nota">
          <mat-icon>content_copy</mat-icon>
        </button>
        <button mat-icon-button color="primary" (click)="shareNote(note)" matTooltip="Condividi" *ngIf="note.canDelete">
          <mat-icon>share</mat-icon>
        </button>
        <button mat-icon-button color="warn" (click)="deleteNote(note)" matTooltip="Elimina" *ngIf="note.canDelete">
          <mat-icon>delete</mat-icon>
        </button>
        <button mat-icon-button color="accent" (click)="leaveNote(note)" matTooltip="Abbandona nota" *ngIf="!note.canDelete && note.isShared">
          <mat-icon>exit_to_app</mat-icon>
        </button>
        <span class="spacer"></span>
        <mat-icon *ngIf="note.isShared" class="shared-icon" matTooltip="Condivisa con te">people</mat-icon>
      </mat-card-actions>
    </mat-card>
  </div>
</div>