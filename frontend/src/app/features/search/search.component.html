<div class="search-container">
  <div class="search-header">
    <h1>Ricerca Note</h1>
  </div>

  <!-- Search Form -->
  <mat-card class="search-form-card">
    <mat-card-content>
      <form [formGroup]="searchForm">
        <div class="search-row">
          <mat-form-field appearance="outline" class="search-field">
            <mat-label>Cerca per titolo o contenuto</mat-label>
            <input matInput formControlName="query"
                   placeholder="Inserisci i termini di ricerca..."
                   (keyup.enter)="onSearch()">
            <mat-icon matSuffix>search</mat-icon>
          </mat-form-field>

          <button mat-raised-button color="primary"
                  (click)="onSearch()" class="search-btn">
            <mat-icon>search</mat-icon>
            Cerca
          </button>
        </div>

        <!-- Filters -->
        <div class="filters-section">
          <h3>Filtri</h3>

          <div class="filter-row">
            <mat-form-field appearance="outline">
              <mat-label>Autore</mat-label>
              <input matInput formControlName="author"
                     placeholder="Nome autore">
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Cartella</mat-label>
              <mat-select formControlName="folderId">
                <mat-option value="">Tutte le cartelle</mat-option>
                <mat-option *ngFor="let folder of folders" [value]="folder.id">
                  {{ folder.name }}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>

          <div class="filter-row">
            <mat-form-field appearance="outline">
              <mat-label>Data creazione da</mat-label>
              <input matInput [matDatepicker]="createdFromPicker" formControlName="createdFrom">
              <mat-datepicker-toggle matIconSuffix [for]="createdFromPicker"></mat-datepicker-toggle>
              <mat-datepicker #createdFromPicker></mat-datepicker>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Data creazione a</mat-label>
              <input matInput [matDatepicker]="createdToPicker" formControlName="createdTo">
              <mat-datepicker-toggle matIconSuffix [for]="createdToPicker"></mat-datepicker-toggle>
              <mat-datepicker #createdToPicker></mat-datepicker>
            </mat-form-field>
          </div>

          <div class="filter-row">
            <mat-form-field appearance="outline">
              <mat-label>Data modifica da</mat-label>
              <input matInput [matDatepicker]="modifiedFromPicker" formControlName="modifiedFrom">
              <mat-datepicker-toggle matIconSuffix [for]="modifiedFromPicker"></mat-datepicker-toggle>
              <mat-datepicker #modifiedFromPicker></mat-datepicker>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Data modifica a</mat-label>
              <input matInput [matDatepicker]="modifiedToPicker" formControlName="modifiedTo">
              <mat-datepicker-toggle matIconSuffix [for]="modifiedToPicker"></mat-datepicker-toggle>
              <mat-datepicker #modifiedToPicker></mat-datepicker>
            </mat-form-field>
          </div>

          <div class="filter-checkboxes">
            <mat-checkbox formControlName="includeShared">
              Includi note condivise
            </mat-checkbox>
          </div>

          <button mat-button color="accent" (click)="clearFilters()" class="clear-filters-btn">
            <mat-icon>clear</mat-icon>
            Pulisci filtri
          </button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>

  <!-- Search Results -->
  <div class="search-results" *ngIf="hasSearched">
    <div class="results-header">
      <h2>Risultati ({{searchResults.length}})</h2>
      <div class="search-stats" *ngIf="searchResults.length > 0">
        Ricerca completata in {{searchTime}}ms
      </div>
    </div>

    <!-- Results List -->
    <div class="results-list" *ngIf="searchResults.length > 0">
      <mat-card class="result-card" *ngFor="let result of searchResults">
        <mat-card-header>
          <mat-icon mat-card-avatar [class]="result.isShared ? 'shared-icon' : 'note-icon'">
            {{result.isShared ? 'share' : 'note'}}
          </mat-icon>
          <mat-card-title>
            <span [innerHTML]="highlightSearchTerm(result.title)"></span>
          </mat-card-title>
          <mat-card-subtitle>
            {{result.createdAt | date:'medium'}} â€¢ {{result.author}}
          </mat-card-subtitle>
        </mat-card-header>

        <mat-card-content>
          <p class="result-snippet"
             [innerHTML]="highlightSearchTerm(result.snippet)">
          </p>
        </mat-card-content>

        <mat-card-actions>
          <button mat-button (click)="openNote(result)">
            <mat-icon>open_in_new</mat-icon>
            Apri
          </button>
          <button mat-button (click)="editNote(result)" *ngIf="result.canEdit">
            <mat-icon>edit</mat-icon>
            Modifica
          </button>
        </mat-card-actions>
      </mat-card>
    </div>

    <!-- Empty State -->
    <div class="no-results" *ngIf="searchResults.length === 0">
      <mat-icon class="no-results-icon">search_off</mat-icon>
      <h2>Nessun risultato trovato</h2>
      <p>Prova a modificare i termini di ricerca o i filtri</p>
    </div>
  </div>

  <!-- Recent Searches -->
  <div class="recent-searches" *ngIf="recentSearches.length > 0 && !hasSearched">
    <h2>Ricerche recenti</h2>
    <mat-chip-set>
      <mat-chip *ngFor="let search of recentSearches"
                (click)="useRecentSearch(search)">
        {{search}}
      </mat-chip>
    </mat-chip-set>
  </div>
</div>
